<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personaje - Sons of Éridhu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ESTILOS GENERALES - MEDIEVAL OSCURO */
        :root {
            --primary-dark: #1a0a1a;
            --secondary-dark: #2d1b2d;
            --accent-gold: #d4af37;
            --accent-silver: #c0c0c0;
            --accent-red: #8b0000;
            --accent-purple: #4a004a;
            --text-light: #e6d8d8;
            --text-gray: #b8b8b8;
            --border-gold: #8b7355;
            --shadow-dark: rgba(0, 0, 0, 0.7);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Garamond', 'Times New Roman', serif;
        }
        
        body {
            background-color: var(--primary-dark);
            color: var(--text-light);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(77, 0, 77, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(139, 0, 0, 0.1) 0%, transparent 20%);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* HEADER */
        .header {
            background: linear-gradient(to bottom, var(--primary-dark), rgba(26, 10, 26, 0.9));
            border-bottom: 3px solid var(--border-gold);
            box-shadow: 0 5px 15px var(--shadow-dark);
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 80px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
        }
        
        .logo-icon {
            font-size: 2.5rem;
            color: var(--accent-gold);
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }
        
        .logo-text {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent-gold);
            letter-spacing: 2px;
            text-transform: uppercase;
            text-shadow: 2px 2px 4px var(--shadow-dark);
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .nav-link {
            color: var(--accent-silver);
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover, .nav-link.active {
            color: var(--accent-gold);
            background-color: rgba(139, 0, 0, 0.2);
        }
        
        .back-btn {
            color: var(--accent-silver);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s ease;
        }
        
        .back-btn:hover {
            color: var(--accent-gold);
        }
        
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--accent-gold);
            font-size: 1.8rem;
            cursor: pointer;
        }
        
        /* CHARACTER CONTAINER */
        .character-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .character-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }
        
        .character-title {
            font-size: 2.5rem;
            color: var(--accent-gold);
            letter-spacing: 1px;
        }
        
        .character-actions {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 25px;
            border: 2px solid var(--border-gold);
            border-radius: 5px;
            background: transparent;
            color: var(--accent-silver);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background-color: rgba(139, 0, 0, 0.3);
            color: var(--accent-gold);
        }
        
        .btn:hover {
            background-color: rgba(212, 175, 55, 0.1);
            transform: translateY(-2px);
        }
        
        /* CHARACTER FORM */
        .character-form {
            background-color: var(--secondary-dark);
            border: 3px solid var(--border-gold);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px var(--shadow-dark);
        }
        
        .form-section {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid rgba(139, 0, 0, 0.3);
        }
        
        .section-title {
            font-size: 1.8rem;
            color: var(--accent-gold);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .section-title i {
            font-size: 1.5rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            color: var(--accent-silver);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 15px;
            background-color: rgba(26, 10, 26, 0.5);
            border: 2px solid var(--border-gold);
            border-radius: 8px;
            color: var(--text-light);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
        }
        
        .form-hint {
            color: var(--text-gray);
            font-size: 0.9rem;
            margin-top: 5px;
            font-style: italic;
        }
        
        /* DYNAMIC FIELDS */
        .dynamic-list {
            margin-top: 15px;
        }
        
        .dynamic-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .dynamic-item input {
            flex: 1;
        }
        
        .remove-btn {
            padding: 8px 12px;
            background-color: rgba(139, 0, 0, 0.5);
            border: 1px solid var(--accent-red);
            border-radius: 5px;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .remove-btn:hover {
            background-color: rgba(139, 0, 0, 0.7);
        }
        
        .add-btn {
            padding: 10px 20px;
            background-color: rgba(74, 0, 74, 0.5);
            border: 2px solid var(--accent-purple);
            border-radius: 5px;
            color: var(--accent-silver);
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .add-btn:hover {
            background-color: rgba(74, 0, 74, 0.7);
        }
        
        /* CHARACTER VIEW */
        .character-view {
            display: none;
        }
        
        .character-card {
            background-color: var(--secondary-dark);
            border: 3px solid var(--border-gold);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px var(--shadow-dark);
        }
        
        .character-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .info-section {
            padding: 25px;
            background-color: rgba(26, 10, 26, 0.3);
            border-radius: 10px;
            border-left: 4px solid var(--accent-gold);
        }
        
        .info-title {
            color: var(--accent-gold);
            font-size: 1.4rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(139, 0, 0, 0.3);
        }
        
        .info-content p {
            margin-bottom: 10px;
            color: var(--text-light);
        }
        
        .info-item {
            margin-bottom: 15px;
        }
        
        .info-label {
            color: var(--accent-silver);
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        
        .info-value {
            color: var(--text-light);
        }
        
        .info-list {
            list-style-type: none;
        }
        
        .info-list li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(139, 0, 0, 0.1);
            color: var(--text-light);
        }
        
        .info-list li:last-child {
            border-bottom: none;
        }
        
        /* FOOTER */
        .footer {
            background-color: var(--primary-dark);
            border-top: 3px solid var(--border-gold);
            padding: 30px 20px;
            margin-top: 60px;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }
        
        .copyright {
            color: var(--text-gray);
            font-size: 0.9rem;
        }
        
        /* RESPONSIVE */
        @media (max-width: 992px) {
            .nav-links {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .character-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .character-actions {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        @media (max-width: 768px) {
            .character-title {
                font-size: 2rem;
            }
            
            .character-form {
                padding: 30px;
            }
            
            .section-title {
                font-size: 1.6rem;
            }
        }
        
        @media (max-width: 576px) {
            .nav-container {
                padding: 0 15px;
            }
            
            .character-container {
                padding: 30px 15px;
            }
            
            .character-form {
                padding: 25px 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
        
        /* ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-out;
        }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--primary-dark);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-gold);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-gold);
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="nav-container">
            <a href="dashboard.html" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-dragon"></i>
                </div>
                <div class="logo-text">Éridhu</div>
            </a>
            
            <nav class="nav-links">
                <a href="dashboard.html" class="nav-link">Panel</a>
                <a href="character.html" class="nav-link active">Personaje</a>
                <a href="news.html" class="nav-link">Noticias</a>
                <a href="missions.html" class="nav-link">Misiones</a>
                <a href="compendium.html" class="nav-link">Compendio</a>
            </nav>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <a href="dashboard.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Volver al Panel
            </a>
        </div>
    </header>

    <!-- CHARACTER MANAGEMENT -->
    <div class="character-container">
        <div class="character-header">
            <h1 class="character-title fade-in" id="pageTitle">Crear Personaje</h1>
            <div class="character-actions">
                <button class="btn" id="viewBtn">Ver Personaje</button>
                <button class="btn btn-primary" id="editBtn">Editar Personaje</button>
            </div>
        </div>
        
        <!-- CHARACTER FORM (for creation/editing) -->
        <div class="character-form fade-in" id="characterForm">
            <form id="characterDataForm">
                <!-- BASIC INFORMATION -->
                <div class="form-section">
                    <h2 class="section-title"><i class="fas fa-user"></i> Información Básica</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nombre" class="form-label">Nombre *</label>
                            <input type="text" id="nombre" class="form-input" placeholder="Ej: Kaelen Márida" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="edad" class="form-label">Edad *</label>
                            <input type="number" id="edad" class="form-input" min="8" max="100" placeholder="Ej: 22" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="altura" class="form-label">Altura *</label>
                            <input type="text" id="altura" class="form-input" placeholder="Ej: 1.85m" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="peso" class="form-label">Peso *</label>
                            <input type="text" id="peso" class="form-input" placeholder="Ej: 78kg" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="genero" class="form-label">Género *</label>
                            <select id="genero" class="form-select" required>
                                <option value="">Seleccionar...</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Femenino">Femenino</option>
                                <option value="No binario">No binario</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="orientacionSexual" class="form-label">Orientación Sexual</label>
                            <select id="orientacionSexual" class="form-select">
                                <option value="">Seleccionar (opcional)</option>
                                <option value="Heterosexual">Heterosexual</option>
                                <option value="Homosexual">Homosexual</option>
                                <option value="Bisexual">Bisexual</option>
                                <option value="Pansexual">Pansexual</option>
                                <option value="Asexual">Asexual</option>
                                <option value="Prefiero no decirlo">Prefiero no decirlo</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="estadoCivil" class="form-label">Estado Civil</label>
                            <select id="estadoCivil" class="form-select">
                                <option value="">Seleccionar (opcional)</option>
                                <option value="Soltero/a">Soltero/a</option>
                                <option value="Casado/a">Casado/a</option>
                                <option value="Divorciado/a">Divorciado/a</option>
                                <option value="Viudo/a">Viudo/a</option>
                                <option value="En una relación">En una relación</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="personalidad" class="form-label">Personalidad *</label>
                        <textarea id="personalidad" class="form-textarea" placeholder="Describe la personalidad de tu personaje..." required></textarea>
                        <div class="form-hint">Mínimo 50 caracteres. Describe cómo actúa, piensa y reacciona tu personaje.</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="historia" class="form-label">Historia *</label>
                        <textarea id="historia" class="form-textarea" placeholder="Cuenta la historia de tu personaje..." required></textarea>
                        <div class="form-hint">Mínimo 100 caracteres. Incluye antecedentes familiares, eventos importantes y motivaciones.</div>
                    </div>
                </div>
                
                <!-- CLASS AND AFFILIATION -->
                <div class="form-section">
                    <h2 class="section-title"><i class="fas fa-crown"></i> Clase y Afiliación</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clase" class="form-label">Clase Social *</label>
                            <select id="clase" class="form-select" required>
                                <option value="">Seleccionar...</option>
                                <option value="Plebeyo">Plebeyo (Clase media-baja)</option>
                                <option value="Diácono">Diácono</option>
                                <option value="Barón/Baronesa">Barón/Baronesa</option>
                                <option value="Conde/Condesa">Conde/Condesa</option>
                                <option value="Marqués/Marquesa">Marqués/Marquesa</option>
                                <option value="Duque/Duquesa">Duque/Duquesa</option>
                                <option value="Archiduque/Archiduquesa">Archiduque/Archiduquesa</option>
                                <option value="Joven Maestro/Maestra">Joven Maestro/Maestra</option>
                            </select>
                            <div class="form-hint">Si eres Joven Maestro, debes pertenecer a una de las 4 grandes familias</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="ascendencia" class="form-label">Ascendencia *</label>
                            <select id="ascendencia" class="form-select" required>
                                <option value="">Seleccionar...</option>
                                <optgroup label="Grandes Familias">
                                    <option value="Familia Momotaro">Familia Momotaro</option>
                                    <option value="Familia Márida">Familia Márida</option>
                                    <option value="Familia Görell">Familia Görell</option>
                                    <option value="Familia Woo">Familia Woo</option>
                                </optgroup>
                                <optgroup label="Grandes Clanes">
                                    <option value="Clan del Gran Archivo Celestial">Clan del Gran Archivo Celestial</option>
                                    <option value="Clan del Gran Cuerpo Púrpura">Clan del Gran Cuerpo Púrpura</option>
                                    <option value="Clan del Gran Veneno de Sangre Infernal">Clan del Gran Veneno de Sangre Infernal</option>
                                </optgroup>
                                <optgroup label="Otros">
                                    <option value="Familia Dra'Kar (Sangre de Dragón)">Familia Dra'Kar (Sangre de Dragón)</option>
                                    <option value="Clan Menor (Personalizado)">Clan Menor (Personalizado)</option>
                                    <option value="Sin afiliación">Sin afiliación</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="arquetipo" class="form-label">Arquetipo *</label>
                            <select id="arquetipo" class="form-select" required>
                                <option value="">Seleccionar...</option>
                                <option value="Espadachín">Espadachín (Familia Momotaro)</option>
                                <option value="Mago">Mago (Familia Márida)</option>
                                <option value="Artista Marcial">Artista Marcial (Familia Görell)</option>
                                <option value="Invocador">Invocador (Familia Woo)</option>
                                <option value="Erudito">Erudito (Clan del Gran Archivo Celestial)</option>
                                <option value="Manipulador Dimensional">Manipulador Dimensional (Clan del Gran Cuerpo Púrpura)</option>
                                <option value="Veneno/Sangre">Veneno/Sangre (Clan del Gran Veneno de Sangre Infernal)</option>
                                <option value="Híbrido (Dra'Kar)">Híbrido (Dra'Kar - Todos los arquetipos)</option>
                                <option value="Personalizado">Personalizado</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="elemento" class="form-label">Elemento Afín *</label>
                            <select id="elemento" class="form-select" required>
                                <option value="">Seleccionar...</option>
                                <option value="Agua">Agua</option>
                                <option value="Fuego">Fuego</option>
                                <option value="Viento">Viento</option>
                                <option value="Rayo">Rayo</option>
                                <option value="Tierra">Tierra</option>
                                <option value="Acero">Acero</option>
                                <option value="Luz">Luz</option>
                                <option value="Oscuridad">Oscuridad</option>
                                <option value="Madera">Madera</option>
                                <option value="Cristal">Cristal</option>
                                <option value="Púrpura">Púrpura (Clan del Gran Cuerpo Púrpura)</option>
                                <option value="Sangre">Sangre (Clan del Gran Veneno de Sangre Infernal)</option>
                                <option value="Veneno">Veneno (Clan del Gran Veneno de Sangre Infernal)</option>
                                <option value="Múltiples">Múltiples (Sangre Dra'Kar)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- STATS AND ABILITIES -->
                <div class="form-section">
                    <h2 class="section-title"><i class="fas fa-chart-line"></i> Estadísticas y Habilidades</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="circuloVital" class="form-label">Círculo Vital *</label>
                            <select id="circuloVital" class="form-select" required>
                                <option value="">Seleccionar...</option>
                                <option value="1er Círculo: Novato Primerizo">1er Círculo: Novato Primerizo</option>
                                <option value="2do Círculo: Novato Experimentado">2do Círculo: Novato Experimentado</option>
                                <option value="3er Círculo: Novato Experto">3er Círculo: Novato Experto</option>
                                <option value="4to Círculo: Veterano Primerizo">4to Círculo: Veterano Primerizo</option>
                                <option value="5to Círculo: Veterano Experimentado">5to Círculo: Veterano Experimentado</option>
                                <option value="6to Círculo: Veterano Experto">6to Círculo: Veterano Experto</option>
                                <option value="7mo Círculo: Sabio Primerizo">7mo Círculo: Sabio Primerizo</option>
                                <option value="8vo Círculo: Sabio Experimentado">8vo Círculo: Sabio Experimentado</option>
                                <option value="9no Círculo: Sabio Experto">9no Círculo: Sabio Experto</option>
                                <option value="10mo Círculo: Maestro">10mo Círculo: Maestro</option>
                            </select>
                            <div class="form-hint">La sangre Dra'Kar aumenta la probabilidad de círculos superiores</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="talento" class="form-label">Talento *</label>
                            <select id="talento" class="form-select" required>
                                <option value="">Seleccionar...</option>
                                <option value="Sin talento">Sin talento</option>
                                <option value="Aventajado">Aventajado</option>
                                <option value="Sobresaliente">Sobresaliente</option>
                                <option value="Genio">Genio</option>
                                <option value="Inigualable">Inigualable</option>
                            </select>
                            <div class="form-hint">La sangre Dra'Kar aumenta la probabilidad de talentos superiores</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cuerpoPurpura" class="form-label">Cuerpo Púrpura</label>
                            <select id="cuerpoPurpura" class="form-select">
                                <option value="">No aplica (solo Clan del Gran Cuerpo Púrpura)</option>
                                <option value="1ra Etapa: Cuerpo Púrpura">1ra Etapa: Cuerpo Púrpura</option>
                                <option value="2da Etapa: Cuerpo Púrpura Negro">2da Etapa: Cuerpo Púrpura Negro</option>
                                <option value="3ra Etapa: Cuerpo Púrpura Puro">3ra Etapa: Cuerpo Púrpura Puro</option>
                                <option value="4ta Etapa: Cuerpo Púrpura Trascendente">4ta Etapa: Cuerpo Púrpura Trascendente</option>
                                <option value="5ta Etapa: Cuerpo Púrpura Celestial">5ta Etapa: Cuerpo Púrpura Celestial</option>
                            </select>
                            <div class="form-hint">Solo para miembros del Clan del Gran Cuerpo Púrpura</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="cuerpoVenenoso" class="form-label">Gran Cuerpo Venenoso</label>
                            <select id="cuerpoVenenoso" class="form-select">
                                <option value="">No aplica (solo Clan del Gran Veneno de Sangre Infernal)</option>
                                <option value="1er Cuerpo: Cuerpo de 1 Veneno">1er Cuerpo: Cuerpo de 1 Veneno</option>
                                <option value="2do Cuerpo: Cuerpo de 5 Venenos">2do Cuerpo: Cuerpo de 5 Venenos</option>
                                <option value="3er Cuerpo: Cuerpo de 10 Venenos">3er Cuerpo: Cuerpo de 10 Venenos</option>
                                <option value="4to Cuerpo: Cuerpo de 100 Venenos">4to Cuerpo: Cuerpo de 100 Venenos</option>
                                <option value="5to Cuerpo: Cuerpo de los 1000 Venenos">5to Cuerpo: Cuerpo de los 1000 Venenos</option>
                                <option value="6to Cuerpo: Cuerpo de 10 000 Venenos">6to Cuerpo: Cuerpo de 10 000 Venenos</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="arteSenda" class="form-label">Arte y Senda</label>
                            <select id="arteSenda" class="form-select">
                                <option value="">No aplica (solo Jovenes Maestros del Clan del Veneno)</option>
                                <option value="Arte del Miasma Carmesí - Senda de la Niebla Carmesí">Arte del Miasma Carmesí - Senda de la Niebla Carmesí</option>
                                <option value="Arte del Miasma Carmesí - Senda del Veneno Parásito">Arte del Miasma Carmesí - Senda del Veneno Parásito</option>
                                <option value="Arte del Miasma Carmesí - Senda de la Corrupción">Arte del Miasma Carmesí - Senda de la Corrupción</option>
                                <option value="Arte de la Sanguijuela Demoniaca - Senda del Sello de Sangre">Arte de la Sanguijuela Demoniaca - Senda del Sello de Sangre</option>
                                <option value="Arte de la Sanguijuela Demoniaca - Senda de la Sanguijuela Interior">Arte de la Sanguijuela Demoniaca - Senda de la Sanguijuela Interior</option>
                                <option value="Arte de la Sanguijuela Demoniaca - Senda del Mar de Sangre">Arte de la Sanguijuela Demoniaca - Senda del Mar de Sangre</option>
                                <option value="Arte del Infierno Carmesí - Senda de la Sangre Tóxica Viva">Arte del Infierno Carmesí - Senda de la Sangre Tóxica Viva</option>
                                <option value="Arte del Infierno Carmesí - Senda de la Plaga de Sangre">Arte del Infierno Carmesí - Senda de la Plaga de Sangre</option>
                                <option value="Arte del Infierno Carmesí - Senda del Dominio del Infierno Carmesí">Arte del Infierno Carmesí - Senda del Dominio del Infierno Carmesí</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Habilidades *</label>
                        <div class="form-hint" id="skillsHint">Cantidad de habilidades según tu Círculo Vital</div>
                        <div class="dynamic-list" id="skillsList">
                            <!-- Skills will be added here dynamically -->
                        </div>
                        <button type="button" class="add-btn" id="addSkillBtn">Añadir Habilidad</button>
                    </div>
                </div>
                
                <!-- EQUIPMENT AND INVENTORY -->
                <div class="form-section">
                    <h2 class="section-title"><i class="fas fa-shield-alt"></i> Equipo e Inventario</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Armamento *</label>
                        <div class="form-hint" id="weaponsHint">Cantidad y calidad de armas según tu clase</div>
                        <div class="dynamic-list" id="weaponsList">
                            <!-- Weapons will be added here dynamically -->
                        </div>
                        <button type="button" class="add-btn" id="addWeaponBtn">Añadir Arma</button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Inventario</label>
                        <div class="form-hint" id="inventoryHint">Cantidad de objetos según tu clase</div>
                        <div class="dynamic-list" id="inventoryList">
                            <!-- Inventory items will be added here dynamically -->
                        </div>
                        <button type="button" class="add-btn" id="addInventoryBtn">Añadir Objeto</button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="moneda" class="form-label">Moneda (¥) *</label>
                            <input type="text" id="moneda" class="form-input" placeholder="Ej: 5000¥ de Cobre, 2¥ de Plata, etc" required>
                            <div class="form-hint">Cantidad máxima según tu clase: Plebeyo (5000¥ Cobre), Noble (2¥ Plata), Archiduque (1¥ Oro), Joven Maestro (10¥ Oro)</div>
                        </div>
                    </div>
                </div>
                
                <!-- FORM ACTIONS -->
                <div class="form-section" style="border-bottom: none; padding-bottom: 0;">
                    <div class="form-row">
                        <div class="form-group" style="width: 100%; text-align: center;">
                            <button type="submit" class="btn btn-primary" style="padding: 15px 50px; font-size: 1.2rem;">Guardar Personaje</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- CHARACTER VIEW (read-only) -->
        <div class="character-view fade-in" id="characterView">
            <!-- Character data will be loaded here by JavaScript -->
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="footer-content">
            <p class="copyright">
                &copy; 2023 Sons of Éridhu - Gestión de Personaje<br>
                Los datos del personaje se guardan localmente en tu navegador.
            </p>
        </div>
    </footer>

    <script>
        // Check if user is logged in
        document.addEventListener('DOMContentLoaded', function() {
            const loggedInUser = localStorage.getItem('eridhuUser');
            
            if (!loggedInUser) {
                // Redirect to login if not logged in
                alert('Debes iniciar sesión para acceder a esta página.');
                window.location.href = 'login.html';
                return;
            }
            
            try {
                const user = JSON.parse(loggedInUser);
                window.currentUserId = user.id;
                
                // Load character data if exists
                loadCharacterData(user.id);
                
            } catch (error) {
                console.error('Error parsing user data:', error);
                localStorage.removeItem('eridhuUser');
                window.location.href = 'login.html';
            }
            
            // Mobile menu toggle
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                const navLinks = document.querySelector('.nav-links');
                navLinks.style.display = navLinks.style.display === 'flex' ? 'none' : 'flex';
            });
            
            // View/Edit toggle
            document.getElementById('viewBtn').addEventListener('click', showCharacterView);
            document.getElementById('editBtn').addEventListener('click', showCharacterForm);
            
            // Initialize dynamic fields
            initializeDynamicFields();
            
            // Form submission
            document.getElementById('characterDataForm').addEventListener('submit', saveCharacter);
            
            // Update hints based on selections
            document.getElementById('clase').addEventListener('change', updateHints);
            document.getElementById('circuloVital').addEventListener('change', updateHints);
            document.getElementById('ascendencia').addEventListener('change', updateSpecialFields);
            
            // Set initial state
            updateHints();
            updateSpecialFields();
        });
        
        // Initialize dynamic form fields
        function initializeDynamicFields() {
            // Skills
            document.getElementById('addSkillBtn').addEventListener('click', function() {
                const skillsList = document.getElementById('skillsList');
                const skillCount = skillsList.children.length;
                const maxSkills = getMaxSkills();
                
                if (skillCount >= maxSkills) {
                    alert(`Solo puedes tener un máximo de ${maxSkills} habilidades según tu Círculo Vital.`);
                    return;
                }
                
                const skillDiv = document.createElement('div');
                skillDiv.className = 'dynamic-item';
                skillDiv.innerHTML = `
                    <input type="text" class="form-input skill-input" placeholder="Nombre de la habilidad" required>
                    <button type="button" class="remove-btn remove-skill">×</button>
                `;
                
                skillsList.appendChild(skillDiv);
                
                // Add remove event
                skillDiv.querySelector('.remove-skill').addEventListener('click', function() {
                    skillDiv.remove();
                });
            });
            
            // Weapons
            document.getElementById('addWeaponBtn').addEventListener('click', function() {
                const weaponsList = document.getElementById('weaponsList');
                const weaponCount = weaponsList.children.length;
                const maxWeapons = getMaxWeapons();
                const weaponRarity = getWeaponRarity();
                
                if (weaponCount >= maxWeapons) {
                    alert(`Solo puedes tener un máximo de ${maxWeapons} armas según tu clase.`);
                    return;
                }
                
                const weaponDiv = document.createElement('div');
                weaponDiv.className = 'dynamic-item';
                weaponDiv.innerHTML = `
                    <input type="text" class="form-input weapon-name" placeholder="Nombre del arma" required>
                    <select class="form-select weapon-rarity" required>
                        <option value="">Rango...</option>
                        <option value="Común" ${weaponRarity === 'Común' ? 'selected' : ''}>Común</option>
                        <option value="Rara" ${weaponRarity === 'Rara' ? 'selected' : ''}>Rara</option>
                        <option value="Épica" ${weaponRarity === 'Épica' ? 'selected' : ''}>Épica</option>
                        <option value="Única" ${weaponRarity === 'Única' ? 'selected' : ''} ${weaponRarity !== 'Única' ? 'disabled' : ''}>Única</option>
                        <option value="Celestial" disabled>Celestial</option>
                        <option value="Ancestral" disabled>Ancestral</option>
                    </select>
                    <input type="text" class="form-input weapon-type" placeholder="Tipo (espada, báculo, etc)">
                    <button type="button" class="remove-btn remove-weapon">×</button>
                `;
                
                weaponsList.appendChild(weaponDiv);
                
                // Add remove event
                weaponDiv.querySelector('.remove-weapon').addEventListener('click', function() {
                    weaponDiv.remove();
                });
            });
            
            // Inventory
            document.getElementById('addInventoryBtn').addEventListener('click', function() {
                const inventoryList = document.getElementById('inventoryList');
                const inventoryCount = inventoryList.children.length;
                const maxInventory = getMaxInventory();
                
                if (inventoryCount >= maxInventory) {
                    alert(`Solo puedes tener un máximo de ${maxInventory} objetos en tu inventario según tu clase.`);
                    return;
                }
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'dynamic-item';
                itemDiv.innerHTML = `
                    <input type="text" class="form-input inventory-item" placeholder="Nombre del objeto" required>
                    <button type="button" class="remove-btn remove-item">×</button>
                `;
                
                inventoryList.appendChild(itemDiv);
                
                // Add remove event
                itemDiv.querySelector('.remove-item').addEventListener('click', function() {
                    itemDiv.remove();
                });
            });
        }
        
        // Calculate max skills based on circle
        function getMaxSkills() {
            const circleSelect = document.getElementById('circuloVital');
            const circleValue = circleSelect.value;
            
            if (!circleValue) return 5; // Default
            
            const circleNumber = parseInt(circleValue.charAt(0));
            
            if (circleNumber >= 1 && circleNumber <= 4) return 5;
            if (circleNumber >= 5 && circleNumber <= 7) return 8;
            if (circleNumber >= 8 && circleNumber <= 9) return 10;
            if (circleNumber === 10) return 15;
            
            return 5;
        }
        
        // Calculate max weapons based on class
        function getMaxWeapons() {
            const classSelect = document.getElementById('clase');
            const classValue = classSelect.value;
            
            if (!classValue) return 1;
            
            if (classValue === 'Joven Maestro/Maestra') {
                // Check if it's the 1er Joven Maestro of Momotaro
                const ascendencia = document.getElementById('ascendencia').value;
                const nombre = document.getElementById('nombre').value;
                
                if (ascendencia === 'Familia Momotaro' && nombre) {
                    // This is a simplification - in reality you'd need to check if it's the firstborn
                    return 2; // Can wield family relic + one other weapon
                }
                return 1;
            }
            
            if (classValue.includes('Archiduque') || classValue.includes('Duque')) return 1;
            
            return 1; // Default
        }
        
        // Get weapon rarity based on class
        function getWeaponRarity() {
            const classSelect = document.getElementById('clase');
            const classValue = classSelect.value;
            
            if (!classValue) return 'Común';
            
            if (classValue === 'Joven Maestro/Maestra') return 'Única';
            if (classValue.includes('Archiduque')) return 'Épica';
            if (classValue.includes('Noble') || classValue.includes('Duque') || classValue.includes('Marqués') || classValue.includes('Conde') || classValue.includes('Barón')) {
                return 'Rara';
            }
            
            return 'Común';
        }
        
        // Calculate max inventory based on class
        function getMaxInventory() {
            const classSelect = document.getElementById('clase');
            const classValue = classSelect.value;
            
            if (!classValue) return 0;
            
            if (classValue === 'Joven Maestro/Maestra') return 5;
            if (classValue.includes('Archiduque')) return 4;
            if (classValue.includes('Noble') || classValue.includes('Duque') || classValue.includes('Marqués') || classValue.includes('Conde') || classValue.includes('Barón')) {
                return 3;
            }
            
            return 0; // Plebeyos empiezan sin inventario
        }
        
        // Update form hints based on selections
        function updateHints() {
            // Skills hint
            const maxSkills = getMaxSkills();
            document.getElementById('skillsHint').textContent = `Puedes tener hasta ${maxSkills} habilidades según tu Círculo Vital.`;
            
            // Weapons hint
            const maxWeapons = getMaxWeapons();
            const weaponRarity = getWeaponRarity();
            document.getElementById('weaponsHint').textContent = `Puedes tener hasta ${maxWeapons} arma(s) de rango ${weaponRarity} según tu clase.`;
            
            // Inventory hint
            const maxInventory = getMaxInventory();
            document.getElementById('inventoryHint').textContent = `Puedes tener hasta ${maxInventory} objeto(s) en tu inventario según tu clase.`;
            
            // Update currency hint
            const classValue = document.getElementById('clase').value;
            let currencyHint = 'Cantidad máxima según tu clase: ';
            
            if (!classValue) {
                currencyHint += 'Plebeyo (5000¥ Cobre), Noble (2¥ Plata), Archiduque (1¥ Oro), Joven Maestro (10¥ Oro)';
            } else if (classValue === 'Plebeyo') {
                currencyHint += '5000¥ de Cobre máximo';
            } else if (classValue.includes('Noble') && !classValue.includes('Archiduque')) {
                currencyHint += '2¥ de Plata máximo';
            } else if (classValue.includes('Archiduque')) {
                currencyHint += '1¥ de Oro máximo';
            } else if (classValue === 'Joven Maestro/Maestra') {
                currencyHint += '10¥ de Oro máximo';
            }
            
            document.querySelector('#moneda + .form-hint').textContent = currencyHint;
        }
        
        // Update special fields based on ancestry
        function updateSpecialFields() {
            const ascendencia = document.getElementById('ascendencia').value;
            const cuerpoPurpura = document.getElementById('cuerpoPurpura');
            const cuerpoVenenoso = document.getElementById('cuerpoVenenoso');
            const arteSenda = document.getElementById('arteSenda');
            
            // Reset all
            cuerpoPurpura.disabled = true;
            cuerpoVenenoso.disabled = true;
            arteSenda.disabled = true;
            
            // Enable based on ancestry
            if (ascendencia === 'Clan del Gran Cuerpo Púrpura') {
                cuerpoPurpura.disabled = false;
            } else if (ascendencia === 'Clan del Gran Veneno de Sangre Infernal') {
                cuerpoVenenoso.disabled = false;
                
                // Check if it's a Joven Maestro
                const clase = document.getElementById('clase').value;
                if (clase === 'Joven Maestro/Maestra') {
                    arteSenda.disabled = false;
                }
            }
        }
        
        // Load character data
        function loadCharacterData(userId) {
            const characters = JSON.parse(localStorage.getItem('eridhuCharacters') || '[]');
            const userCharacter = characters.find(char => char.userId == userId);
            
            if (userCharacter) {
                // Populate form fields
                document.getElementById('nombre').value = userCharacter.nombre || '';
                document.getElementById('edad').value = userCharacter.edad || '';
                document.getElementById('altura').value = userCharacter.altura || '';
                document.getElementById('peso').value = userCharacter.peso || '';
                document.getElementById('genero').value = userCharacter.genero || '';
                document.getElementById('orientacionSexual').value = userCharacter.orientacionSexual || '';
                document.getElementById('estadoCivil').value = userCharacter.estadoCivil || '';
                document.getElementById('personalidad').value = userCharacter.personalidad || '';
                document.getElementById('historia').value = userCharacter.historia || '';
                document.getElementById('clase').value = userCharacter.clase || '';
                document.getElementById('ascendencia').value = userCharacter.ascendencia || '';
                document.getElementById('arquetipo').value = userCharacter.arquetipo || '';
                document.getElementById('elemento').value = userCharacter.elemento || '';
                document.getElementById('circuloVital').value = userCharacter.circuloVital || '';
                document.getElementById('talento').value = userCharacter.talento || '';
                document.getElementById('cuerpoPurpura').value = userCharacter.cuerpoPurpura || '';
                document.getElementById('cuerpoVenenoso').value = userCharacter.cuerpoVenenoso || '';
                document.getElementById('arteSenda').value = userCharacter.arteSenda || '';
                document.getElementById('moneda').value = userCharacter.moneda || '';
                
                // Populate skills
                const skillsList = document.getElementById('skillsList');
                skillsList.innerHTML = '';
                if (userCharacter.habilidades && Array.isArray(userCharacter.habilidades)) {
                    userCharacter.habilidades.forEach(skill => {
                        const skillDiv = document.createElement('div');
                        skillDiv.className = 'dynamic-item';
                        skillDiv.innerHTML = `
                            <input type="text" class="form-input skill-input" value="${skill}" required>
                            <button type="button" class="remove-btn remove-skill">×</button>
                        `;
                        skillsList.appendChild(skillDiv);
                        
                        skillDiv.querySelector('.remove-skill').addEventListener('click', function() {
                            skillDiv.remove();
                        });
                    });
                }
                
                // Populate weapons
                const weaponsList = document.getElementById('weaponsList');
                weaponsList.innerHTML = '';
                if (userCharacter.armamento && Array.isArray(userCharacter.armamento)) {
                    userCharacter.armamento.forEach(weapon => {
                        const weaponDiv = document.createElement('div');
                        weaponDiv.className = 'dynamic-item';
                        weaponDiv.innerHTML = `
                            <input type="text" class="form-input weapon-name" value="${weapon.nombre || ''}" required>
                            <select class="form-select weapon-rarity" required>
                                <option value="">Rango...</option>
                                <option value="Común" ${weapon.rango === 'Común' ? 'selected' : ''}>Común</option>
                                <option value="Rara" ${weapon.rango === 'Rara' ? 'selected' : ''}>Rara</option>
                                <option value="Épica" ${weapon.rango === 'Épica' ? 'selected' : ''}>Épica</option>
                                <option value="Única" ${weapon.rango === 'Única' ? 'selected' : ''}>Única</option>
                                <option value="Celestial" ${weapon.rango === 'Celestial' ? 'selected' : ''} disabled>Celestial</option>
                                <option value="Ancestral" ${weapon.rango === 'Ancestral' ? 'selected' : ''} disabled>Ancestral</option>
                            </select>
                            <input type="text" class="form-input weapon-type" value="${weapon.tipo || ''}" placeholder="Tipo">
                            <button type="button" class="remove-btn remove-weapon">×</button>
                        `;
                        weaponsList.appendChild(weaponDiv);
                        
                        weaponDiv.querySelector('.remove-weapon').addEventListener('click', function() {
                            weaponDiv.remove();
                        });
                    });
                }
                
                // Populate inventory
                const inventoryList = document.getElementById('inventoryList');
                inventoryList.innerHTML = '';
                if (userCharacter.inventario && Array.isArray(userCharacter.inventario)) {
                    userCharacter.inventario.forEach(item => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'dynamic-item';
                        itemDiv.innerHTML = `
                            <input type="text" class="form-input inventory-item" value="${item}" required>
                            <button type="button" class="remove-btn remove-item">×</button>
                        `;
                        inventoryList.appendChild(itemDiv);
                        
                        itemDiv.querySelector('.remove-item').addEventListener('click', function() {
                            itemDiv.remove();
                        });
                    });
                }
                
                // Update page title
                document.getElementById('pageTitle').textContent = `Editar: ${userCharacter.nombre}`;
                
                // Show character view by default
                showCharacterView();
            } else {
                // No character exists, show form for creation
                showCharacterForm();
                document.getElementById('pageTitle').textContent = 'Crear Personaje';
            }
            
            // Update hints and special fields
            updateHints();
            updateSpecialFields();
        }
        
        // Show character form (edit mode)
        function showCharacterForm() {
            document.getElementById('characterForm').style.display = 'block';
            document.getElementById('characterView').style.display = 'none';
            document.getElementById('viewBtn').style.display = 'inline-block';
            document.getElementById('editBtn').style.display = 'none';
            document.getElementById('pageTitle').textContent = document.getElementById('nombre').value 
                ? `Editar: ${document.getElementById('nombre').value}` 
                : 'Crear Personaje';
        }
        
        // Show character view (read-only mode)
        function showCharacterView() {
            const user = JSON.parse(localStorage.getItem('eridhuUser'));
            if (!user) return;
            
            const characters = JSON.parse(localStorage.getItem('eridhuCharacters') || '[]');
            const userCharacter = characters.find(char => char.userId == user.id);
            
            if (!userCharacter) {
                alert('No tienes un personaje creado. Crea uno primero.');
                showCharacterForm();
                return;
            }
            
            // Build character view HTML
            let characterHTML = `
                <div class="character-card">
                    <div class="character-info">
                        <!-- Basic Info -->
                        <div class="info-section">
                            <h3 class="info-title"><i class="fas fa-user"></i> Información Básica</h3>
                            <div class="info-content">
                                <div class="info-item">
                                    <span class="info-label">Nombre:</span>
                                    <span class="info-value">${userCharacter.nombre || 'No especificado'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Edad:</span>
                                    <span class="info-value">${userCharacter.edad || 'No especificado'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Altura/Peso:</span>
                                    <span class="info-value">${userCharacter.altura || 'No especificado'} / ${userCharacter.peso || 'No especificado'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Género:</span>
                                    <span class="info-value">${userCharacter.genero || 'No especificado'}</span>
                                </div>
                                ${userCharacter.orientacionSexual ? `
                                <div class="info-item">
                                    <span class="info-label">Orientación Sexual:</span>
                                    <span class="info-value">${userCharacter.orientacionSexual}</span>
                                </div>
                                ` : ''}
                                ${userCharacter.estadoCivil ? `
                                <div class="info-item">
                                    <span class="info-label">Estado Civil:</span>
                                    <span class="info-value">${userCharacter.estadoCivil}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Class and Affiliation -->
                        <div class="info-section">
                            <h3 class="info-title"><i class="fas fa-crown"></i> Clase y Afiliación</h3>
                            <div class="info-content">
                                <div class="info-item">
                                    <span class="info-label">Clase Social:</span>
                                    <span class="info-value">${userCharacter.clase || 'No especificada'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Ascendencia:</span>
                                    <span class="info-value">${userCharacter.ascendencia || 'No especificada'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Arquetipo:</span>
                                    <span class="info-value">${userCharacter.arquetipo || 'No especificado'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Elemento Afín:</span>
                                    <span class="info-value">${userCharacter.elemento || 'No especificado'}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Stats and Abilities -->
                        <div class="info-section">
                            <h3 class="info-title"><i class="fas fa-chart-line"></i> Estadísticas</h3>
                            <div class="info-content">
                                <div class="info-item">
                                    <span class="info-label">Círculo Vital:</span>
                                    <span class="info-value">${userCharacter.circuloVital || 'No especificado'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Talento:</span>
                                    <span class="info-value">${userCharacter.talento || 'No especificado'}</span>
                                </div>
                                ${userCharacter.cuerpoPurpura ? `
                                <div class="info-item">
                                    <span class="info-label">Cuerpo Púrpura:</span>
                                    <span class="info-value">${userCharacter.cuerpoPurpura}</span>
                                </div>
                                ` : ''}
                                ${userCharacter.cuerpoVenenoso ? `
                                <div class="info-item">
                                    <span class="info-label">Gran Cuerpo Venenoso:</span>
                                    <span class="info-value">${userCharacter.cuerpoVenenoso}</span>
                                </div>
                                ` : ''}
                                ${userCharacter.arteSenda ? `
                                <div class="info-item">
                                    <span class="info-label">Arte y Senda:</span>
                                    <span class="info-value">${userCharacter.arteSenda}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Equipment and Inventory -->
                        <div class="info-section">
                            <h3 class="info-title"><i class="fas fa-shield-alt"></i> Equipo</h3>
                            <div class="info-content">
                                <div class="info-item">
                                    <span class="info-label">Moneda (¥):</span>
                                    <span class="info-value">${userCharacter.moneda || 'No especificada'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Armamento:</span>
                                    <span class="info-value">
                                        ${userCharacter.armamento && userCharacter.armamento.length > 0 
                                            ? userCharacter.armamento.map(w => `${w.nombre} (${w.rango}${w.tipo ? `, ${w.tipo}` : ''})`).join(', ') 
                                            : 'Ninguno'}
                                    </span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Inventario:</span>
                                    <span class="info-value">
                                        ${userCharacter.inventario && userCharacter.inventario.length > 0 
                                            ? userCharacter.inventario.join(', ') 
                                            : 'Vacío'}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Personality and History -->
                        <div class="info-section" style="grid-column: 1 / -1;">
                            <h3 class="info-title"><i class="fas fa-scroll"></i> Personalidad</h3>
                            <div class="info-content">
                                <p>${userCharacter.personalidad || 'No especificada'}</p>
                            </div>
                        </div>
                        
                        <div class="info-section" style="grid-column: 1 / -1;">
                            <h3 class="info-title"><i class="fas fa-history"></i> Historia</h3>
                            <div class="info-content">
                                <p>${userCharacter.historia || 'No especificada'}</p>
                            </div>
                        </div>
                        
                        <!-- Skills -->
                        <div class="info-section" style="grid-column: 1 / -1;">
                            <h3 class="info-title"><i class="fas fa-fire"></i> Habilidades</h3>
                            <div class="info-content">
                                <ul class="info-list">
                                    ${userCharacter.habilidades && userCharacter.habilidades.length > 0 
                                        ? userCharacter.habilidades.map(skill => `<li>${skill}</li>`).join('') 
                                        : '<li>No tiene habilidades registradas</li>'}
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="showCharacterForm()">Editar Personaje</button>
                    </div>
                </div>
            `;
            
            document.getElementById('characterView').innerHTML = characterHTML;
            document.getElementById('characterForm').style.display = 'none';
            document.getElementById('characterView').style.display = 'block';
            document.getElementById('viewBtn').style.display = 'none';
            document.getElementById('editBtn').style.display = 'inline-block';
            document.getElementById('pageTitle').textContent = userCharacter.nombre || 'Personaje';
        }
        
        // Save character data
        function saveCharacter(e) {
            e.preventDefault();
            
            const user = JSON.parse(localStorage.getItem('eridhuUser'));
            if (!user) {
                alert('Error: No se pudo identificar al usuario.');
                return;
            }
            
            // Validate required fields
            const requiredFields = [
                'nombre', 'edad', 'altura', 'peso', 'genero', 'personalidad', 
                'historia', 'clase', 'ascendencia', 'arquetipo', 'elemento',
                'circuloVital', 'talento', 'moneda'
            ];
            
            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    alert(`El campo "${field.previousElementSibling.textContent.replace(' *', '')}" es obligatorio.`);
                    field.focus();
                    return;
                }
            }
            
            // Validate skills count
            const skillInputs = document.querySelectorAll('.skill-input');
            const maxSkills = getMaxSkills();
            if (skillInputs.length > maxSkills) {
                alert(`Solo puedes tener un máximo de ${maxSkills} habilidades según tu Círculo Vital.`);
                return;
            }
            
            // Validate weapons count
            const weaponInputs = document.querySelectorAll('.weapon-name');
            const maxWeapons = getMaxWeapons();
            if (weaponInputs.length > maxWeapons) {
                alert(`Solo puedes tener un máximo de ${maxWeapons} arma(s) según tu clase.`);
                return;
            }
            
            // Validate inventory count
            const inventoryInputs = document.querySelectorAll('.inventory-item');
            const maxInventory = getMaxInventory();
            if (inventoryInputs.length > maxInventory) {
                alert(`Solo puedes tener un máximo de ${maxInventory} objeto(s) en tu inventario según tu clase.`);
                return;
            }
            
            // Collect skills
            const habilidades = [];
            skillInputs.forEach(input => {
                if (input.value.trim()) {
                    habilidades.push(input.value.trim());
                }
            });
            
            // Collect weapons
            const armamento = [];
            const weaponNames = document.querySelectorAll('.weapon-name');
            const weaponRarities = document.querySelectorAll('.weapon-rarity');
            const weaponTypes = document.querySelectorAll('.weapon-type');
            
            for (let i = 0; i < weaponNames.length; i++) {
                if (weaponNames[i].value.trim()) {
                    armamento.push({
                        nombre: weaponNames[i].value.trim(),
                        rango: weaponRarities[i].value,
                        tipo: weaponTypes[i].value.trim() || ''
                    });
                }
            }
            
            // Collect inventory
            const inventario = [];
            inventoryInputs.forEach(input => {
                if (input.value.trim()) {
                    inventario.push(input.value.trim());
                }
            });
            
            // Build character object
            const character = {
                id: Date.now(),
                userId: user.id,
                nombre: document.getElementById('nombre').value.trim(),
                edad: document.getElementById('edad').value.trim(),
                altura: document.getElementById('altura').value.trim(),
                peso: document.getElementById('peso').value.trim(),
                genero: document.getElementById('genero').value,
                orientacionSexual: document.getElementById('orientacionSexual').value,
                estadoCivil: document.getElementById('estadoCivil').value,
                personalidad: document.getElementById('personalidad').value.trim(),
                historia: document.getElementById('historia').value.trim(),
                clase: document.getElementById('clase').value,
                ascendencia: document.getElementById('ascendencia').value,
                arquetipo: document.getElementById('arquetipo').value,
                elemento: document.getElementById('elemento').value,
                circuloVital: document.getElementById('circuloVital').value,
                talento: document.getElementById('talento').value,
                cuerpoPurpura: document.getElementById('cuerpoPurpura').value || null,
                cuerpoVenenoso: document.getElementById('cuerpoVenenoso').value || null,
                arteSenda: document.getElementById('arteSenda').value || null,
                habilidades: habilidades,
                armamento: armamento,
                inventario: inventario,
                moneda: document.getElementById('moneda').value.trim(),
                updatedAt: new Date().toISOString()
            };
            
            // Get existing characters
            let characters = JSON.parse(localStorage.getItem('eridhuCharacters') || '[]');
            
            // Check if character already exists for this user
            const existingIndex = characters.findIndex(char => char.userId == user.id);
            
            if (existingIndex >= 0) {
                // Update existing character
                character.id = characters[existingIndex].id;
                character.createdAt = characters[existingIndex].createdAt;
                characters[existingIndex] = character;
            } else {
                // Add new character
                character.createdAt = new Date().toISOString();
                characters.push(character);
            }
            
            // Save to localStorage
            localStorage.setItem('eridhuCharacters', JSON.stringify(characters));
            
            // Show success message
            alert('¡Personaje guardado exitosamente!');
            
            // Switch to view mode
            loadCharacterData(user.id);
            showCharacterView();
        }
    </script>
</body>
</html>